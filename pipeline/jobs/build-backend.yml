parameters:
  - workingDirectory: ""
    buildPlatform: "Any CPU"
    buildConfiguration: "Release"

steps:
  - task: DotNetCoreCLI@2
    inputs:
      command: restore
      projects: |
        **/*.csproj
      workingDirectory: $(workingDirectory)
    displayName: "Restore Dependencies"

  - task: DotNetCoreCLI@2
    inputs:
      command: build
      projects: |
        **/*.csproj
      workingDirectory: $(workingDirectory)
      arguments: "-c $(buildConfiguration)"
    displayName: "Build Projects"

  - task: DotNetCoreCLI@2
    inputs:
      command: test
      projects: |
        **/*Tests.csproj
      workingDirectory: $(workingDirectory)
      arguments: "-c $(buildConfiguration) /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura"
    displayName: "Run Tests"

  - task: DotNetCoreCLI@2
    inputs:
      command: "publish"
      projects: |
        **/*.csproj
      workingDirectory: $(workingDirectory)
      arguments: "-c $(buildConfiguration) -o $(workingDirectory)/publish"
      publishWebProjects: false
      zipAfterPublish: false
    displayName: "dotnet publish"

  - publish: $(workingDirectory)/publish
    artifact: $(artifactName)
    displayName: "Publish Backend Artifacts"
