parameters:
  workingDirectory: ""
  buildPlatform: "Any CPU"
  buildConfiguration: "Release"

steps:
  - task: DotNetCoreCLI@2
    inputs:
      command: restore
      projects: |
        **/*.csproj
      workingDirectory: ${{ parameters.workingDirectory }}
    displayName: "Restore Dependencies"

  - task: DotNetCoreCLI@2
    inputs:
      command: build
      projects: |
        **/*.csproj
      workingDirectory: ${{ parameters.workingDirectory }}
      arguments: "-c ${{ parameters.buildConfiguration }}"
    displayName: "Build Projects"

  - task: DotNetCoreCLI@2
    inputs:
      command: test
      projects: |
        **/*Tests.csproj
      workingDirectory: ${{ parameters.workingDirectory }}
      arguments: "-c ${{ parameters.buildConfiguration }} /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura"
    displayName: "Run Tests"

  - task: DotNetCoreCLI@2
    inputs:
      command: "publish"
      projects: |
        **/*.csproj
      workingDirectory: ${{ parameters.workingDirectory }}
      arguments: "-c ${{ parameters.buildConfiguration }} -o ${{ parameters.workingDirectory }}/publish"
      publishWebProjects: false
      zipAfterPublish: false
    displayName: "dotnet publish"

  - publish: ${{ parameters.workingDirectory }}/publish
    artifact: $(artifactName)
    displayName: "Publish Backend Artifacts"
